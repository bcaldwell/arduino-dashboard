{"version":3,"sources":["../../../src/arduino/modules/-read.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;AAEb,SAAS,UAAU,CAAC,KAAK,EAAE,KAAK,EAAE;AAChC,SAAQ,OAAO,KAAK,KAAK,WAAW,GAAG,KAAK,GAAG,KAAK,CAAE;CACvD;;IAEK,IAAI;AACR,WADI,IAAI,CACI,SAAS,EAAE,OAAO,EAAE,EAAE,EAAE,GAAG,EAAE,MAAM,EAAE,WAAW,EAAE;;;0BAD1D,IAAI;;;;AAIN,UAAM,GAAG,UAAU,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;AACnC,eAAW,GAAG,UAAU,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;;AAE3C,QAAI,CAAC,SAAS,GAAG,SAAS,CAAC;AAC3B,QAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AACf,QAAI,CAAC,OAAO,GAAG,OAAO,CAAC;;AAEvB,QAAI,CAAC,MAAM,GAAG,CAAC,CAAC;AAChB,QAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AACvB,QAAI,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC;;;AAAC,AAGzC,QAAI,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;AACpC,QAAI,CAAC,YAAY,GAAG,CAAC;;;AAAC,AAGtB,QAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC9B,QAAI,CAAC,WAAW,GAAG,WAAW,CAAC;AAC/B,QAAI,CAAC,IAAI,GAAG;AACV,cAAQ,EAAE,CAAC;AACX,gBAAU,EAAE,IAAI;AAChB,YAAM,EAAE,IAAI;KACb,CAAC;;AAEF,QAAI,CAAC,OAAO,CAAC,IAAI,CAAC,UAAC,KAAK,EAAE,KAAK,EAAK;AAClC,UAAI,MAAK,MAAM,EAAE;AACf,cAAK,SAAS,CAAC,KAAK,CAAC,CAAC;OACvB,MAAM;AACL,cAAK,SAAS,CAAC,MAAK,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC;OAC7C;AACD,UAAI,IAAI,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;AACtB,UAAI,MAAK,MAAM,KAAK,MAAK,IAAI,CAAC,MAAM,IAAI,MAAK,MAAM,KAAK,MAAK,IAAI,CAAC,UAAU,IAAI,IAAI,GAAG,MAAK,IAAI,CAAC,QAAQ,GAAG,MAAK,WAAW,EAAE;AAC5H,UAAE,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,GAAG,SAAS,EAAE;AACrC,aAAG,EAAE,MAAK,GAAG;AACb,gBAAM,EAAE,MAAK,MAAM;SACpB,CAAC,CAAC;AACH,cAAK,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AAC1B,cAAK,IAAI,CAAC,UAAU,GAAG,MAAK,MAAM,CAAC;OACpC;KACF,CAAC,CAAC;GACJ;;eA5CG,IAAI;;gCA8CI;AACV,aAAO,IAAI,CAAC,MAAM,CAAC;KACpB;;;8BACS,MAAM,EAAE;AAChB,UAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;AAC/B,UAAI,CAAC,MAAM,GAAG,MAAM,CAAC;KACtB;;;oCACe,GAAG,EAAE;;AAEnB,UAAI,IAAI,CAAC,SAAS,EAAE;AAClB,eAAQ,IAAI,CAAC,SAAS,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,CAAE;OAC9C,MAAM;AACL,eAAO,GAAG,CAAC;OACZ;KACF;;;;;6BAEQ,GAAG,EAAE;AACZ,aAAO,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;KAChD;;;SAhEG,IAAI;;;AAiET,CAAC;;AAEF,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC","file":"-read.js","sourcesContent":["'use strict';\n\nfunction setDefault(param, value) {\n  return (typeof param === \"undefined\" ? value : param);\n}\n\nclass Read {\n  constructor(routeName, arduino, io, pin, analog, minDuration) {\n    // var self = this;\n\n    analog = setDefault(analog, false);\n    minDuration = setDefault(minDuration, 200);\n\n    this.routeName = routeName;\n    this.pin = pin;\n    this.arduino = arduino;\n\n    this.status = 0;\n    this.lastStatus = null;\n    this.readPin = new arduino.Pin(this.pin);\n\n    //is the selected pin an analog pin?\n    this.analogPin = this.isAnalog(pin);\n    this.lastSendTime = 0;\n\n    //analog mode or digital mode\n    this.analog = Boolean(analog);\n    this.minDuration = minDuration;\n    this.last = {\n      sendTime: 0,\n      sendStatus: null,\n      status: null\n    };\n\n    this.readPin.read((error, value) => {\n      if (this.analog) {\n        this.setStatus(value);\n      } else {\n        this.setStatus(this.analogToDigital(value));\n      }\n      var time = Date.now();\n      if (this.status !== this.last.status && this.status !== this.last.sendStatus && time - this.last.sendTime > this.minDuration) {\n        io.sockets.emit(routeName + ':change', {\n          pin: this.pin,\n          status: this.status\n        });\n        this.last.sendTime = time;\n        this.last.sendStatus = this.status;\n      }\n    });\n  }\n\n  getStatus() {\n    return this.status;\n  }\n  setStatus(status) {\n    this.last.status = this.status;\n    this.status = status;\n  }\n  analogToDigital(val) {\n    //only analog pin need the value adjected for digital read\n    if (this.analogPin) {\n      return (this.analogPin && val < 512 ? 0 : 1);\n    } else {\n      return val;\n    }\n  };\n  //remove this\n  isAnalog(pin) {\n    return Boolean(this.arduino.Pin.isAnalog(pin));\n  };\n};\n\nmodule.exports = Read;\n"]}